#! /bin/sh


err () { printf "${0##*/}: \e[31merror:\e[0m %s\n" "$*" >&2; exit 1; }


case "$1" in
	-h|--help)
		printf "%s\n" \
			"${0##*/}: print the external commands called by a shell script." \
			"" \
			"usage:" \
			"  ${0##*/} [-h|--help]" \
			"  ${0##*/} <script>"
		exit
	;;
esac


#	functions.

_list_cmds () {
	sed '/^#/d' "$@" \
		| sed 's:(:\n:g' \
		| sed 's:{:\n:g' \
		| sed 's:`:\n:g' \
		| sed 's:|:\n:g' \
		| sed 's:&:\n:g' \
		| sed 's:;:\n:g' \
		| sed 's:exec:\n:g' \
		| sed 's:eval:\n:g' \
		| sed 's:^[ \t]*::' \
		| sed '/^$/d'
}


_get_path () {
	while read f; do
		which -- "$f" && continue
		test -f "$f" && printf "%s\n" "$f"
	done 2> /dev/null
}


#	get the list.

_list_cmds "$@" \
	| awk '{ print $1 }' \
	| sort -u \
	| _get_path
